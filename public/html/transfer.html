<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../pics/ocbc-title-logo.png" type="image/x-icon">
    <link rel="stylesheet" href="../css/transfer.css">
    <title>OCBC - Transfer Money</title>

    <!-- Import Google Fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>


    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
        }

        .legend {
            margin: 20px auto;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .legend h3 {
            margin-bottom: 10px;
        }

        .legend ul {
            list-style: none;
            padding: 0;
        }

        .legend ul li {
            margin: 10px 0;
            display: flex;
            align-items: center;
        }

        .legend ul li span {
            font-weight: bold;
            color: #007bff;
            margin-right: 10px;
        }

       /* Webcam container */
        .webcam-container {
            position: fixed;
            bottom: 20px; /* Position at the bottom */
            right: 20px; /* Align to the right */
            z-index: 1000; /* Ensure it stays above other elements */
            background-color: rgba(0, 0, 0, 0.8); /* Semi-transparent black background */
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Webcam video styling */
        #webcam-video {
            width: 320px; /* Adjust width */
            height: 240px; /* Adjust height */
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            display: none; /* Hidden by default */
        }

        /* Button styling */
        #toggle-webcam {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
        }

        #toggle-webcam:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }

        #toggle-webcam:active {
            transform: scale(0.95);
        }

        .button-group {
            display: flex;
            gap: 13px;
            margin-bottom: 10px;
            margin-top: 20px;
        }
        .option-btn, .amount-btn, .desc-btn {
            background-color: #ffffff;   /* Set background color to white */
            color: #000000;              /* Set font color to black */
            padding: 13px 20px;
            border: 2px solid #5a5a5a;   /* Set border color to black */
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            text-align: center;
            transition: background-color 0.3s ease;
        }

        .option-btn:hover, .amount-btn:hover, .desc-btn:hover {
            background-color: #f0f0f0;   /* Light grey background on hover */
        }
        .plus-btn {
        background-color: #007bff; /* Blue background */
        color: white; /* White text */
        border: none;
        border-radius: 50%; /* Round shape */
        width: 40px; /* Button width */
        height: 40px; /* Button height */
        font-size: 24px; /* Font size for the plus sign */
        cursor: pointer;
        display: inline-block;
        text-align: center;
        line-height: 40px; /* Center the plus sign vertically */
    }

    .plus-btn:hover {
        background-color: #0056b3; /* Darker blue on hover */
    }

    /* Modal styles */
    .modal {
        display: none; /* Hidden by default */
        position: fixed;
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full screen */
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* Background color with transparency */
        overflow: auto;
        padding-top: 60px;
    }

    .modal-content {
        background-color: #fff;
        margin: auto;
        padding: 30px;
        border: 1px solid #888;
        width: 60%; /* Increased width of modal */
        max-width: 600px; /* Max width */
        border-radius: 8px;
        position: relative; /* For positioning the close button */
    }

    .close-btn {
        color: #aaa;
        font-size: 36px; /* Increased size for close button */
        font-weight: bold;
        position: absolute;
        top: 10px;
        right: 15px; /* Right position adjusted */
    }

    .close-btn:hover,
    .close-btn:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .modal h2 {
        margin-top: 0;
    }
    .contact-label {
    font-size: 16px; /* Font size for the label */
    font-weight: bold; /* Make the label text bold */
    margin-bottom: 8px; /* Space below the label */
    margin-top: 20px;
    display: block; /* Make label take up the full width */
    color: #333; /* Dark color for the label text */
    }

    /* Styling the "Add Contact" button */
    .add-contact-btn {
        background-color: #0056b3; /* Blue background color */
        color: #fff; /* White text color */
        padding: 12px 20px; /* Padding for the button */
        font-size: 16px; /* Font size for the button text */
        margin-top: 30px;
        border: none; /* Remove default border */
        border-radius: 5px; /* Rounded corners */
        cursor: pointer; /* Show pointer cursor on hover */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Add a subtle shadow */
        transition: background-color 0.3s ease, transform 0.2s ease; /* Smooth transition for hover effects */
    }

    /* Label styles inside the modal */
    .description-label {
        font-size: 16px; /* Font size for the label */
        font-weight: bold; /* Make the label text bold */
        margin-bottom: 8px; /* Space below the label */
        margin-top: 20px; /* Space above the label */
        display: block; /* Make label take up the full width */
        color: #333; /* Dark color for the label text */
    }

    /* Input fields inside the modal */
    .modal input[type="text"] {
        width: calc(100% - 20px); /* Full width minus padding */
        padding: 10px;
        font-size: 14px; /* Adjust font size */
        border: 1px solid #ccc; /* Light border color */
        border-radius: 5px; /* Rounded corners */
        margin-bottom: 20px; /* Space between input fields */
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle inner shadow */
    }

    /* Styling the "Add Description" button */
    .add-description-btn {
        background-color: #0056b3; /* Blue background color */
        color: #fff; /* White text color */
        padding: 12px 20px; /* Padding for the button */
        font-size: 16px; /* Font size for the button text */
        margin-top: 10px;
        border: none; /* Remove default border */
        border-radius: 5px; /* Rounded corners */
        cursor: pointer; /* Show pointer cursor on hover */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Add a subtle shadow */
        transition: background-color 0.3s ease, transform 0.2s ease; /* Smooth transition for hover effects */
    }

    .add-description-btn:hover {
        background-color: #004099; /* Darker blue on hover */
        transform: translateY(-2px); /* Slightly lift the button on hover */
    }

    /* Progress Container */
    .progress-container {
    width: 100%;
    margin: 20px 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    border: 2px solid black; /* Black outline around the container */
    padding: 20px; /* Optional: Add some padding inside the container */
    border-radius: 10px; /* Optional: Rounded corners */
    background-color: #f9f9f9; /* Optional: Light background color for contrast */
    }

    /* Progress Bar */
    .progress-bar {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        width: 100%;
        max-width: 600px; /* Optional: Limit the max width of the progress bar */
        height: 20px;
        background-color: #e0e0e0; /* Light gray background */
        border-radius: 10px;
        overflow: hidden;
        position: relative;
    }

    /* Individual Steps */
    .progress-step {
        height: 100%;
        background-color: #e0e0e0; /* Default step color (red) */
        transition: background-color 0.3s, width 0.3s;
    }

    /* Active Steps */
    .progress-step.active {
        background-color: #4caf50; /* Green for completed steps */
    }

    /* Optional: Add spacing between steps */
    .progress-step:not(:last-child) {
        border-right: 1px solid white; /* Divider between steps */
    }

    /* Progress Percentage */
    .progress-percentage {
        font-size: 20px;
        font-weight: bold;
        text-align: center;
        margin-top: 10px; /* Add space above the percentage */
        color: #333;
    }

    #incomplete-fields {
        margin-top: 20px;
        text-align: center; /* Aligns the text to the center */
        width: 100%;
        max-width: 400px;
        margin-left: auto; /* Center the box horizontally */
        margin-right: auto; /* Center the box horizontally */
        display: flex; /* Enables flexbox layout */
        flex-direction: column; /* Aligns content vertically */
        align-items: center; /* Centers content horizontally */
    }


    #incomplete-list {
        padding-left: 20px;
    }

    .AI-container {
            text-align: center;
            /* Center aligns all elements inside */
            display: flex;
            flex-direction: column;
            /* Stacks elements vertically */
            align-items: center;
            /* Aligns buttons properly */
            justify-content: center;
            padding-top: 20px;
            padding-bottom: 20px;
        }

        /* AI Assistant Button Styling */
        #ai-assistant-button {
            background-color: #4CAF50;
            color: white;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            padding: 12px 40px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        #ai-assistant-button:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }

        #ai-assistant-button:focus,
        #help-button:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.7);
        }

    </style>
</head>

<body>
    <!-- Header Section -->
    <header class="header">
        <div class="logo">
            <img src="../pics/ocbc-bg.png" alt="OCBC Logo">
        </div>

        <!-- Text-to-Speech Toggle Slider with Status -->
        <div class="tts-toggle-container">
            <label class="switch">
                <input type="checkbox" id="toggle-tts" onchange="toggleTTS()">
                <span class="slider"></span>
            </label>
            <span id="tts-status">Hover to listen: <b>OFF</b></span>
        </div>

        <div class="header-right">
            <div class="font-size-controls">
                <button onclick="changeFontSize(-2)" onmouseover="speakText('Click here to reduce font size')">A-</button>
                <button onclick="resetFontSize()" onmouseover="speakText('Click here to reset font size to normal')">A</button>
                <button onclick="changeFontSize(2)" onmouseover="speakText('Click here to increase font size')">A+</button>
            </div>
            
            <div class="language-switch">
                <a href="transferchi.html" class="language-btn">‰∏≠Êñá</a>
            </div>

            <button id="mode-toggle" onclick="toggleMode()">Switch to Dark Mode</button>

            <div class="peer-support">
                <button class="tooltip peer-support-btn" tabindex="0" aria-label="Peer Support Forum" onclick="window.location.href='peer_support.html';">
                    Peer Support Forum
                </button>
            </div>
            
            <div class="logout">
                <button id="logout-btn" onmouseover="speakText('Click here to securely log out of your account.')"> 
                    Logout
                    <img src="../pics/logout.png" alt="Logout Icon" class="login-icon">
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content Section -->
    <main>
        <div class="container">
            <!-- Welcome message -->
            <div class="welcome" id="welcome-message" onmouseover="speakText('Welcome to OCBC Digital Banking, ' + document.getElementById('user-name').innerText)">Welcome, <span id="user-name"></span></div>
            <!-- Gesture Legend -->
            <div class="legend">
                <h3>Gesture Controls Legend</h3>
                <ul>
                    <li><span>‚úã Open Hand:</span> Clear the current field</li>
                    <li><span>üëç Thumbs Up:</span> Submit the form</li>
                    <li><span>‚úåÔ∏è Peace Sign:</span> Move to the next field</li>
                </ul>
            </div>

            <!-- Keyboard Shortcuts Note--> 
            <div id="keyboard-shortcut-note" class="keyboard-note" role="complementary" aria-label="Keyboard Shortcuts">
                <p id="keyboard-shortcut-header">
                    <strong>Keyboard Shortcuts:</strong> <span id="dropdown-icon"></span>
                </p>
                <ul id="shortcut-list">
                    <li onmouseover="speakText('Press the number one key to view your accounts')"><span class="shortcut-key">1</span> ‚Üí View Accounts</li>
                    <li onmouseover="speakText('Press the number two key to transfer money')"><span class="shortcut-key">2</span> ‚Üí Transfer Money</li>
                    <li onmouseover="speakText('Press the number three key to view investments')"><span class="shortcut-key">3</span> ‚Üí Investments</li>
                    <li onmouseover="speakText('Press the C key to switch to Chinese language')"><span class="shortcut-key">C</span> ‚Üí Chinese Translation</li>
                    <li onmouseover="speakText('Press the L key to log out of your account')"><span class="shortcut-key">L</span> ‚Üí Log Out</li>
                    <li onmouseover="speakText('Press Left Arrow for Previous Page')"><span class="shortcut-key">‚Üê</span> ‚Üí Previous Page</li>
                    <li onmouseover="speakText('Press Right Arrow for Next Page')"><span class="shortcut-key">‚Üí</span> ‚Üí Next Page</li>
                    <li onmouseover="speakText('Press Up Arrow to Scroll Up')"><span class="shortcut-key">‚Üë</span> ‚Üí Scroll Up</li>
                    <li onmouseover="speakText('Press Down Arrow to Scroll Down')"><span class="shortcut-key">‚Üì</span> ‚Üí Scroll Down</li>
                </ul>
            </div>

            <!-- What would you like to do today? -->
            <h2 class="welcome-message" onmouseover="speakText('What would you like to do today?')">What would you like to do today?</h2>
            <!-- Navigation bar -->
            <div class="navbar">
                <a href="../html/accountseng.html" onmouseover="speakText('Click here to view your bank accounts and details')">
                    <img src="../pics/view-account.png" alt="View Icon">
                    View Accounts</a>
                <a href="../html/transfer.html" class="active" onmouseover="speakText('Click here to Transfer Money to other people')">
                    <img src="../pics/transfer-money.png" alt="Transfer Money Icon">
                    Transfer Money</a>
                <a href="../html/investmenteng.html" onmouseover="speakText('Click here to view and manage your investments')">
                    <img src="../pics/investment.png" alt="Investments Icon">
                    Investments</a>
                <a href="../html/location.html" class="tooltip" tabindex="0" aria-label="Find ATMs">
                    <img src="../pics/atm.png" alt="Location Icon">
                    Find Branches
                </a>
                <a href="../html/currencyExchange.html" class="tooltip" tabindex="0" aria-label="Currency Exchange">
                    <img src="../pics/exchange.png" alt="Location Icon">
                    Currency Exchange
                </a>
            </div>

            <div class="AI-container">
                <!-- AI Assistant Button (Now placed right below the Walkthrough button) -->
                <button id="ai-assistant-button" class="tooltip ai-btn" tabindex="0" aria-label="AI Assistant"
                    onclick="window.location.href='assistant.html';">
                    AI Assistant
                </button>
            </div>

            <div class="webcam-container">
                <button id="toggle-webcam" onclick="toggleWebcam()">Turn On Webcam</button>
                <video id="webcam-video" autoplay playsinline style="display: none;"></video>
            </div>
            
            
            <div id="webcam-overlay" style="display: none;">
                <div id="webcam-container">
                    <video id="webcam-video" autoplay playsinline></video>
                    <button id="toggle-webcam" onclick="toggleWebcam()">Turn Off Webcam</button>
                </div>
            </div>
            
        </div>
        <div class="transfer-container">
            <h2>Transfer and Payments</h2>
            <form>
                <!--<p>Not to worry! If you didnt finish the form and left the page, progress will be saved.</p>-->
                <!-- Make a transfer from -->
                <div class="form-group">
                    <label for="transfer-from" onmouseover="speakText('Over here, you can choose which bank accounts do you want to make transfer from.')">1. Make a transfer from</label>
                    <select id="transfer-from" onchange="giveVoiceFeedback('transfer-from')">
                        <option value="" disabled selected>Select an account</option>
                    </select>
                </div>

                <!-- Transferring money to -->
                <div class="form-group">
                    <label>2. Send Money Using:</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="transfer-to" value="mobile" onclick="toggleInput('mobile');">
                            Mobile number
                        </label>
                        <label>
                            <input type="radio" name="transfer-to" value="nric" onclick="toggleInput('nric');">
                            NRIC
                        </label>
                    </div>


                    <!-- Button group that appears before input when mobile option is selected -->
                    <div class="button-group" style="display: none;">
                        <button type="button" class="option-btn" onclick="selectRecipient('Alex Tan', '87654321')">Transfer to Ah Tan (Alex)</button>
                        <button type="button" class="option-btn" onclick="selectRecipient('Daniel Lee', '93218765')">Transfer to Son (Daniel)</button>
                        <button type="button" class="option-btn" onclick="selectRecipient('Jane Smith', '98765432')">Transfer to Wife (Jane)</button>
                        <!-- Plus button to add more frequent contacts -->
                        <button type="button" class="plus-btn" onclick="toggleAddContactForm()">+</button>
                    </div>
                    
                    <!-- Modal for adding new contact (hidden by default) -->
                    <div id="add-contact-modal" class="modal" style="display: none;">
                        <div class="modal-content">
                            <span class="close-btn" onclick="closeAddContactForm()">√ó</span>
                            <h2>Add New Contact</h2>
                            
                            <label for="contact-name">Enter Contact Name:</label>
                            <input type="text" id="contact-name" placeholder="Enter name (e.g. Friend Ah Tan (George))">
                            
                            <label for="contact-phone" class="contact-label">Enter Phone Number:</label>
                            <input type="text" id="contact-phone" placeholder="Enter phone number (e.g. 91234567)">
                            
                            <button type="button" class="add-contact-btn" onclick="addNewContact()">Add Contact</button>
                        </div>
                    </div>

                    <!-- Transfer input group with text box below the options -->
                    <div class="transfer-input-group" style="display: none;">
                        <input type="text" id="mobile" class="input-box" placeholder="Enter mobile number" style="display: none;" oninput="giveVoiceFeedback('mobile')"oninput="updateProgress()"oninput="saveFormData()">
                        <input type="text" id="nric" class="input-box" placeholder="Enter NRIC" style="display: none;" oninput="giveVoiceFeedback('nric')"oninput="saveFormData()">
                        <button type="button" id="enterBtn" class="enter-btn">Verify</button>
                    </div>

                    <!-- Display recipient name below the input group -->
                    <p id="verifiedName" style="display: none;">Recipient Name: <span id="user-namee" style="font-weight: bold;"></span></p>
                    <p id="error" style="display: none;">Recipient Name: <span id="user-namee" style="font-weight: bold;"></span></p>
                </div>

                <!-- Amount and Description -->
                <div class="form-group">
                    <label for="amount" onmouseover="speakText('Enter the amount that you want to transfer, in Singapore dollars.')">3. Amount to Transfer:</label>
                    <!-- Rectangle Button for Amount input -->
                    <div class="button-group">
                        <button type="button" class="amount-btn" onclick="fillAmount('10.00')">10 SGD</button>
                        <button type="button" class="amount-btn" onclick="fillAmount('20.00')">20 SGD</button>
                        <button type="button" class="amount-btn" onclick="fillAmount('50.00')">50 SGD</button>
                        <button type="button" class="amount-btn" onclick="fillAmount('100.00')">100 SGD</button>
                        <button type="button" class="amount-btn" onclick="fillAmount('200.00')">200 SGD</button>
                        <button type="button" class="amount-btn" onclick="fillAmount('500.00')">500 SGD</button>
                        <button type="button" class="amount-btn" onclick="fillAmount('1000.00')">1000 SGD</button>
                    </div>
                    <div class="amount-transfer">
                        <input type="text" id="amount" placeholder="Amount(SGD)" oninput="giveVoiceFeedback('amount')"oninput="saveFormData()">
                    </div>
                    <div id="balance" class="balance-display" style="display: none;">
                        Current Balance: <b><span id="balance-amount"></span> SGD</b>
                    </div>
                </div>

                <div class="form-group">
                    <label for="description" onmouseover="speakText('Enter a description for this transfer, like the purpose and your name')">4. Description of Transfer:</label>
                    <p style="padding-bottom:5px;">Include the purpose of transfer and your name </p>
                    <div class="button-group description-button-group"> <!-- Unique class added here -->
                        <button type="button" class="desc-btn" onclick="fillDescription('Gift for birthday - [YOUR NAME]')">Gift for birthday</button>
                        <button type="button" class="desc-btn" onclick="fillDescription('Bill Payment - [YOUR NAME]')">Bill Payment</button>
                        <button type="button" class="desc-btn" onclick="fillDescription('Loan Repayment - [YOUR NAME]')">Loan Repayment</button>
                        <!-- Plus button to add new descriptions -->
                        <button type="button" class="plus-btn" onclick="toggleDescriptionModal()">+</button>
                    </div>
                    <!-- Description input field -->
                    <input type="text" id="description" placeholder="Description" oninput="giveVoiceFeedback('description')">

                    <!-- Add Description Modal -->
                    <div id="add-description-modal" class="modal" style="display: none;">
                        <div class="modal-content">
                            <span class="close-btn" onclick="closeDescriptionModal()">√ó</span>
                            <h3 style="margin-bottom:20px; font-size:22px;">Add a New Description</h3>
                            <label for="new-button-name">Button Name:</label>
                            <input type="text" id="new-button-name" placeholder="Enter button name (e.g., Gift, Loan)">

                            <label for="new-description">Description:</label>
                            <input type="text" id="new-description" placeholder="Enter description (e.g., Gift for a friend's birthday)">

                            <button type="button" class="add-description-btn" onclick="addNewDescription()">Add Description</button>
                        </div>
                    </div>
                    <!-- Checkbox for saving as a favorite transaction -->
                    <label>
                        <input type="checkbox" id="status-checkbox" onchange="giveVoiceFeedback('status-checkbox')"> Enable 24-Hour Delay Transfer (Optional)
                        <span class="info-icon">What is this?
                            <span class="tooltip-text">This option delays the transfer by 24 hours. During this period, you can cancel the transaction 
                                if needed. After 24 hours, the funds will be sent and deducted from your account automatically.</span>
                        </span>
                    </label> 
                </div>

                <div class="progress-container">
                    <h2>Step-by-Step Progress Tracker</h2>
                    <p style="margin-bottom: 20px; margin-top:-20px;">Track your completion progress in transferring money</p>
                    <div class="progress-bar">
                        <div id="step1" class="progress-step"></div>
                        <div id="step2" class="progress-step"></div>
                        <div id="step3" class="progress-step"></div>
                        <div id="step4" class="progress-step"></div>
                    </div>
                    <div class="progress-percentage">0% Completed</div>
                    <div id="incomplete-fields">
                        <p style="margin-bottom:10px; margin-top: 20px;"><b>Incomplete</b> Input Fields:</p>
                        <ul id="incomplete-list">
                            <li>Choose bank account</li>
                            <li>Enter mobile number</li>
                            <li>Specify transfer amount</li>
                            <li>Add description of transfer</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Transfer button -->
                <div class="form-group">
                    <button type="submit" class="transfer-btn" onmouseover="speakText('Click here to complete the transfer. Please double-check that all details are correct before proceeding.')">Transfer</button>
                </div>
            </form>
            <div id="update-msg" style="display: none;">
                <div class="alert alert-success" role="alert">
                    <dotlottie-player src="https://lottie.host/3a0e448a-e059-491a-ba78-53734f104751/5XWEjdqtkJ.json" background="transparent" speed="0.7" style="width: 300px; height: 300px;" loop autoplay></dotlottie-player>
                </div>
            </div>
            
        </div>
    </main>

    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
    <script src="../js/transferform.js"></script>
    <script>
        const videoElement = document.getElementById("webcam-video");
        const toggleWebcamButton = document.getElementById('toggle-webcam');
        let isWebcamActive = false;

        let camera; // Declare the camera variable globally

        function toggleWebcam() {
            const video = document.getElementById("webcam-video");
            const button = document.getElementById("toggle-webcam");

            if (!video || !button) {
                console.error("Webcam video or button element not found!");
                return;
            }

            if (video.style.display === "none") {
                // Show video and start webcam
                video.style.display = "block";
                button.textContent = "Turn Off Webcam";
                startWebcam(video);
            } else {
                // Hide video and stop webcam
                video.style.display = "none";
                button.textContent = "Turn On Webcam";
                stopWebcam(video);
            }
        }

        function startWebcam(video) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then((stream) => {
                    video.srcObject = stream;
                })
                .catch((err) => {
                    console.error("Error accessing webcam: ", err);
                });
        }

        function stopWebcam(video) {
            if (video.srcObject) {
                const stream = video.srcObject;
                stream.getTracks().forEach((track) => track.stop());
                video.srcObject = null;
            } else {
                console.warn("No active webcam stream to stop.");
            }
        }

        // Ensure the webcam is off when the page loads
        window.onload = () => {
            videoElement.style.display = 'none';
            toggleWebcamButton.textContent = 'Turn On Webcam';
            isWebcamActive = false;
        };

        // Gesture detection and MediaPipe Hands logic
        const formFields = [
            document.querySelector('#transfer-from'),
            document.querySelector('#mobile'),
            document.querySelector('#nric'),
            document.querySelector('#amount'),
            document.querySelector('#description'),
            document.querySelector('.transfer-btn'),
        ];

        const hands = new Hands({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`,
        });
        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.7,
            minTrackingConfidence: 0.7,
        });

        hands.onResults(onResults);

        let activeFieldIndex = 0;

        function onResults(results) {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];

                if (isOpenHand(landmarks)) {
                    console.log('Open Hand Detected: Clearing the current field');
                    clearField();
                } else if (isThumbsUp(landmarks)) {
                    console.log('Thumbs Up Detected: Submitting the form');
                    formFields[formFields.length - 1].click();
                } else if (isPeaceSign(landmarks)) {
                    console.log('Peace Sign Detected: Moving to the next field');
                    moveToNextField();
                } else {
                    console.log('Unknown Gesture Detected');
                }
            } else {
                console.log('No hand detected');
            }
        }

        function clearField() {
            if (activeFieldIndex < formFields.length - 1) {
                const activeField = formFields[activeFieldIndex];
                if (activeField.tagName === 'INPUT' || activeField.tagName === 'TEXTAREA' || activeField.tagName === 'SELECT') {
                    activeField.value = '';
                }
            }
        }

        function moveToNextField() {
            if (activeFieldIndex < formFields.length - 1) {
                const currentField = formFields[activeFieldIndex];
                const nextField = formFields[++activeFieldIndex];

                if (currentField) currentField.blur();
                if (nextField) nextField.focus();
            }
        }

        function isOpenHand(landmarks) {
            return (
                landmarks[8].y < landmarks[7].y && // Index finger extended
                landmarks[12].y < landmarks[11].y && // Middle finger extended
                landmarks[16].y < landmarks[15].y && // Ring finger extended
                landmarks[20].y < landmarks[19].y && // Pinky finger extended
                landmarks[4].x > landmarks[3].x // Thumb pointing outward
            );
        }

        function isThumbsUp(landmarks) {
            return (
                landmarks[4].y < landmarks[3].y + 0.05 &&
                landmarks[8].y > landmarks[7].y &&
                landmarks[12].y > landmarks[11].y &&
                landmarks[16].y > landmarks[15].y &&
                landmarks[20].y > landmarks[19].y
            );
        }

        function isPeaceSign(landmarks) {
            return (
                landmarks[8].y < landmarks[7].y && // Index finger extended
                landmarks[12].y < landmarks[11].y && // Middle finger extended
                landmarks[16].y > landmarks[15].y && // Ring finger curled
                landmarks[20].y > landmarks[19].y // Pinky curled
            );
        }

        // Ensure videoElement is defined

        setInterval(async () => {
            if (videoElement && videoElement.srcObject) {
                try {
                    // Process one frame every interval
                    await hands.send({ image: videoElement });
                    console.log("Running hand detection...");
                } catch (error) {
                    console.error("Error during hand detection:", error);
                }
            } else {
                console.warn("No active webcam stream detected for hand detection.");
            }
        }, 4000); // 4000ms = 4 seconds

        // Function to fill the amount input field
        function fillAmount(amount) {
            document.getElementById('amount').value = amount;  // Set the value of the amount input field
            giveVoiceFeedback('amount');  // Optionally, give voice feedback (you may adjust this as needed)
        }

        // Function to fill the description input field
        function fillDescription(description) {
            document.getElementById('description').value = description;  // Set the value of the description input field
            giveVoiceFeedback('description');  // Optionally, give voice feedback (you may adjust this as needed)
        }

        function selectRecipient(name, phoneNumber) {
            const verifiedName = document.getElementById('verifiedName');
            const userNameSpan = document.getElementById('user-namee');
            const mobileInput = document.getElementById('mobile');
            
            // Set the recipient name
            userNameSpan.textContent = name;
            verifiedName.style.display = 'block'; // Display the recipient name

            // Set the mobile number in the input field
            mobileInput.value = phoneNumber;
        }

        function toggleInput(type) {
        const mobileInput = document.getElementById('mobile');
        const nricInput = document.getElementById('nric');
        const transferInputGroup = document.querySelector('.transfer-input-group');
        const buttonGroup = document.querySelector('.button-group');
        const enterBtn = document.getElementById('enterBtn');

        // Hide both inputs and button group initially
        mobileInput.style.display = 'none';
        nricInput.style.display = 'none';
        enterBtn.style.display = 'none';
        buttonGroup.style.display = 'none';

        if (type === 'mobile') {
            // Show the mobile input and button group
            mobileInput.style.display = 'block';
            buttonGroup.style.display = 'block'; // Display the button group
            enterBtn.style.display = 'block';
        } else if (type === 'nric') {
            // Show NRIC input, hide mobile input and button group
            nricInput.style.display = 'block';
            buttonGroup.style.display = 'none'; // Hide the button group
            enterBtn.style.display = 'block';
        }

        // Show the transfer input group
        transferInputGroup.style.display = 'block';
    }

function toggleAddContactForm() {      
        // Show the modal to add a new contact
        const modal = document.getElementById('add-contact-modal');
        modal.style.display = 'block';
    }

    function closeAddContactForm() {
        // Close the modal and clear input fields
        const modal = document.getElementById('add-contact-modal');
        modal.style.display = 'none';
        document.getElementById('contact-name').value = '';
        document.getElementById('contact-phone').value = '';
    }

    function addNewContact() {
        // Get the entered name and phone number
        const name = document.getElementById('contact-name').value;
        const phone = document.getElementById('contact-phone').value;

        if (name && phone) {
            // Create a new button with the entered name and phone number
            const newButton = document.createElement('button');
            newButton.type = 'button';
            newButton.className = 'option-btn';
            newButton.textContent = `Transfer to ${name}`;
            newButton.onclick = function() {
                selectRecipient(name, phone);
            };

            // Append the new button to the button group
            const buttonGroup = document.querySelector('.button-group');
            buttonGroup.insertBefore(newButton, buttonGroup.lastElementChild);  // Add before the plus button

            // Close the modal after adding
            closeAddContactForm();
        } else {
            alert('Please enter both a name and a phone number.');
        }
    }

    function toggleDescriptionModal() {
    // Show the modal for adding a description
    document.getElementById("add-description-modal").style.display = "block";
    }

    function closeDescriptionModal() {
        // Hide the modal
        document.getElementById("add-description-modal").style.display = "none";
    }

    function fillDescription(desc) {
        // Fill the input field with the selected description
        document.getElementById("description").value = desc;
    }

    function addNewDescription() {
        // Get the new button name and description entered by the user
        const buttonName = document.getElementById("new-button-name").value;
        const newDescription = document.getElementById("new-description").value;

        if (buttonName && newDescription) {
            // Create a new button with the entered name and description
            const newButton = document.createElement("button");
            newButton.type = "button";
            newButton.className = "desc-btn";
            newButton.textContent = buttonName; // Button displays the name
            newButton.onclick = function () {
                fillDescription(newDescription); // Fills the input field with the description
            };

            // Append the new button to the description button group
            const buttonGroup = document.querySelector(".description-button-group");
            buttonGroup.insertBefore(newButton, buttonGroup.lastElementChild); // Add before the plus button

            // Close the modal after adding
            closeDescriptionModal();

            // Clear the modal fields for next use
            document.getElementById("new-button-name").value = '';
            document.getElementById("new-description").value = '';
        } else {
            alert("Please enter both a button name and a description.");
        }
    }

    function selectRecipient(name, phone) {
        // Fill in the phone number and name based on the selected recipient
        document.getElementById('mobile').value = phone;  // Assuming there's an input with id="mobile"
    }

    const fields = [
    { id: "transfer-from", label: "Choose bank account" },
    { id: "mobile", label: "Enter mobile number", validator: (value) => /^[89]\d{7}$/.test(value) },
    { id: "amount", label: "Specify transfer amount" },
    { id: "description", label: "Add description of transfer" },
    ];

    const progressSteps = document.querySelectorAll(".progress-step");
    const progressPercentage = document.querySelector(".progress-percentage");
    const incompleteContainer = document.getElementById("incomplete-fields");
    const incompleteList = document.getElementById("incomplete-list");

    // Function to update progress and incomplete steps
    function updateProgress() {
        let completedSteps = 0;
        const incompleteSteps = [];

        fields.forEach(({ id, label, validator }) => {
            const field = document.getElementById(id);
            if (!field) return; // Skip if field is not found
            const value = field.value.trim();
            const isValid = validator ? validator(value) : value !== "";

            if (isValid) {
                completedSteps++;
            } else {
                incompleteSteps.push(label);
            }
        });

        // Update progress bar
        progressSteps.forEach((step, index) => {
            if (index < completedSteps) {
                step.classList.add("active");
            } else {
                step.classList.remove("active");
            }
        });

        // Update percentage
        const percentage = Math.round((completedSteps / fields.length) * 100);
        progressPercentage.textContent = `${percentage}% Completed`;

        // Update incomplete fields visibility in real-time
        if (incompleteSteps.length > 0) {
            incompleteContainer.style.display = "block";
            incompleteList.innerHTML = incompleteSteps
                .map((step) => `<li><span class="cross-icon">‚ùå</span> ${step}</li>`)
                .join("");
        } else {
            incompleteContainer.style.display = "none";
        }
    }

    // Pre-fill function for amount buttons
    function fillAmount(amount) {
        const amountInput = document.getElementById("amount");
        amountInput.value = amount; // Pre-fill the amount input field
        updateProgress(); // Update the progress bar and incomplete steps
    }

    // Pre-fill function for description input field
    function fillDescription(description) {
        const descriptionInput = document.getElementById("description");
        descriptionInput.value = description; // Pre-fill the description input field
        updateProgress(); // Update the progress bar and incomplete steps
    }

    // Attach event listeners to all fields for real-time updates
    fields.forEach(({ id }) => {
        const field = document.getElementById(id);
        if (field) {
            field.addEventListener("input", updateProgress); // Trigger update on input
        }
    });

    function selectRecipient(name, phoneNumber) {
        // Prefill the phone number input field
        const mobileInput = document.getElementById("mobile");
        mobileInput.value = phoneNumber;

        // Prefill the recipient name in the verifiedName paragraph
        const userName = document.getElementById("user-namee");
        userName.textContent = name;

        // Update the progress bar
        updateProgress();
    }

    // Initialize the progress tracker on page load
    updateProgress();

    /*Save form data and progress bar value to sessionStorage
function saveFormData() {
    const formData = {
        transferFrom: document.getElementById('transfer-from').value,
        transferTo: document.querySelector('input[name="transfer-to"]:checked')?.value,
        mobile: document.getElementById('mobile').value,
        nric: document.getElementById('nric').value,
        amount: document.getElementById('amount').value,
        description: document.getElementById('description').value,
        progress: document.getElementById('progress-bar').value // Save progress bar value
    };
    sessionStorage.setItem('transferFormDraft', JSON.stringify(formData));
}

// Load form data and progress bar value from sessionStorage
function loadFormData() {
    const draft = JSON.parse(sessionStorage.getItem('transferFormDraft'));
    if (draft) {
        document.getElementById('transfer-from').value = draft.transferFrom || '';
        if (draft.transferTo) {
            document.querySelector(`input[name="transfer-to"][value="${draft.transferTo}"]`).checked = true;
        }
        document.getElementById('mobile').value = draft.mobile || '';
        document.getElementById('nric').value = draft.nric || '';
        document.getElementById('amount').value = draft.amount || '';
        document.getElementById('description').value = draft.description || '';

        // Restore progress bar value
        document.getElementById('progress-bar').value = draft.progress || 0;
    }
}

// Detect when the user is leaving the page to save form data
window.addEventListener('beforeunload', saveFormData);

// Check if there‚Äôs a draft on page load
window.addEventListener('DOMContentLoaded', function () {
    loadFormData();
    // If there is a saved draft, show the 'Retrieve Saved Draft' button
    const draft = JSON.parse(sessionStorage.getItem('transferFormDraft'));
    if (draft) {
        document.getElementById('retrieve-draft-btn').style.display = 'inline-block';
    }
});*/

      </script>
    <script src="https://website-widgets.pages.dev/dist/sienna.min.js" defer></script>
</body>
</html>