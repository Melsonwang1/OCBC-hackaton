<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../pics/ocbc-title-logo.png" type="image/x-icon">
    <link rel="stylesheet" href="../css/transfer.css">
    <title>OCBC - Transfer Money</title>

    <!-- Import Google Fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>



    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
        }

        .legend {
            margin: 20px auto;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .legend h3 {
            margin-bottom: 10px;
        }

        .legend ul {
            list-style: none;
            padding: 0;
        }

        .legend ul li {
            margin: 10px 0;
            display: flex;
            align-items: center;
        }

        .legend ul li span {
            font-weight: bold;
            color: #007bff;
            margin-right: 10px;
        }

       /* Webcam container */
        .webcam-container {
            position: fixed;
            bottom: 20px; /* Position at the bottom */
            right: 20px; /* Align to the right */
            z-index: 1000; /* Ensure it stays above other elements */
            background-color: rgba(0, 0, 0, 0.8); /* Semi-transparent black background */
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Webcam video styling */
        #webcam-video {
            width: 320px; /* Adjust width */
            height: 240px; /* Adjust height */
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            display: none; /* Hidden by default */
        }

        /* Button styling */
        #toggle-webcam {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
        }

        #toggle-webcam:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }

        #toggle-webcam:active {
            transform: scale(0.95);
        }


        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }

        .typing-placeholder {
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            display: inline-block;
            border-right: 2px solid #333;
            animation: typing 4s steps(25, end), blink 0.5s step-end infinite alternate;
        }

        @keyframes blink {
            50% { border-color: transparent; }
        }
        input[readonly] {
            cursor: not-allowed;
            background-color: #f9f9f9;
            color: #888;
            font-style: italic;
            border: 1px solid #ccc;
        }

        input:focus {
            background-color: #fff;
            color: #000;
            font-style: normal;
            border: 1px solid #007bff;
        }
    </style>
</head>

<body>
    <!-- Header Section -->
    <header class="header">
        <div class="logo">
            <img src="../pics/ocbc-bg.png" alt="OCBC Logo">
        </div>

        <!-- Text-to-Speech Toggle Slider with Status -->
        <div class="tts-toggle-container">
            <label class="switch">
                <input type="checkbox" id="toggle-tts" onchange="toggleTTS()">
                <span class="slider"></span>
            </label>
            <span id="tts-status">Hover to listen: <b>OFF</b></span>
        </div>

        <div class="header-right">
            <div class="font-size-controls">
                <button onclick="changeFontSize(-2)" onmouseover="speakText('Click here to reduce font size')">A-</button>
                <button onclick="resetFontSize()" onmouseover="speakText('Click here to reset font size to normal')">A</button>
                <button onclick="changeFontSize(2)" onmouseover="speakText('Click here to increase font size')">A+</button>
            </div>
            
            <div class="language-switch">
                <a href="transferchi.html" class="language-btn">‰∏≠Êñá</a>
            </div>
            <div class="logout">
                <button id="logout-btn" onmouseover="speakText('Click here to securely log out of your account.')"> 
                    Logout
                    <img src="../pics/logout.png" alt="Logout Icon" class="login-icon">
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content Section -->
    <main>
        <div class="container">
            <!-- Welcome message -->
            <div class="welcome" id="welcome-message" onmouseover="speakText('Welcome to OCBC Digital Banking, ' + document.getElementById('user-name').innerText)">Welcome, <span id="user-name"></span></div>
            <!-- Gesture Legend -->
            <div class="legend">
                <h3>Gesture Controls Legend</h3>
                <ul>
                    <li><span>‚úã Open Hand:</span> Clear the current field</li>
                    <li><span>üëç Thumbs Up:</span> Submit the form</li>
                    <li><span>‚úåÔ∏è Peace Sign:</span> Move to the next field</li>
                </ul>
            </div>

            <!-- Keyboard Shortcuts Note--> 
            <div id="keyboard-shortcut-note" class="keyboard-note" role="complementary" aria-label="Keyboard Shortcuts">
                <p id="keyboard-shortcut-header">
                    <strong>Keyboard Shortcuts:</strong> <span id="dropdown-icon"></span>
                </p>
                <ul id="shortcut-list">
                    <li onmouseover="speakText('Press the number one key to view your accounts')"><span class="shortcut-key">1</span> ‚Üí View Accounts</li>
                    <li onmouseover="speakText('Press the number two key to transfer money')"><span class="shortcut-key">2</span> ‚Üí Transfer Money</li>
                    <li onmouseover="speakText('Press the number three key to view investments')"><span class="shortcut-key">3</span> ‚Üí Investments</li>
                    <li onmouseover="speakText('Press the C key to switch to Chinese language')"><span class="shortcut-key">C</span> ‚Üí Chinese Translation</li>
                    <li onmouseover="speakText('Press the L key to log out of your account')"><span class="shortcut-key">L</span> ‚Üí Log Out</li>
                    <li onmouseover="speakText('Press Left Arrow for Previous Page')"><span class="shortcut-key">‚Üê</span> ‚Üí Previous Page</li>
                    <li onmouseover="speakText('Press Right Arrow for Next Page')"><span class="shortcut-key">‚Üí</span> ‚Üí Next Page</li>
                    <li onmouseover="speakText('Press Up Arrow to Scroll Up')"><span class="shortcut-key">‚Üë</span> ‚Üí Scroll Up</li>
                    <li onmouseover="speakText('Press Down Arrow to Scroll Down')"><span class="shortcut-key">‚Üì</span> ‚Üí Scroll Down</li>
                </ul>
            </div>

            <!-- What would you like to do today? -->
            <h2 class="welcome-message" onmouseover="speakText('What would you like to do today?')">What would you like to do today?</h2>
            <!-- Navigation bar -->
            <div class="navbar">
                <a href="../html/accountseng.html" onmouseover="speakText('Click here to view your bank accounts and details')">
                    <img src="../pics/view-account.png" alt="View Icon">
                    View Accounts</a>
                <a href="../html/transfer.html" class="active" onmouseover="speakText('Click here to Transfer Money to other people')">
                    <img src="../pics/transfer-money.png" alt="Transfer Money Icon">
                    Transfer Money</a>
                <a href="../html/investmenteng.html" onmouseover="speakText('Click here to view and manage your investments')">
                    <img src="../pics/investment.png" alt="Investments Icon">
                    Investments</a>
                <a href="../html/location.html" class="tooltip" tabindex="0" aria-label="Find ATMs">
                    <img src="../pics/atm.png" alt="Location Icon">
                    Find Branches
                </a>
            </div>
            <div class="webcam-container">
                <button id="toggle-webcam" onclick="toggleWebcam()">Turn On Webcam</button>
                <video id="webcam-video" autoplay playsinline style="display: none;"></video>
            </div>
            
            
            <div id="webcam-overlay" style="display: none;">
                <div id="webcam-container">
                    <video id="webcam-video" autoplay playsinline></video>
                    <button id="toggle-webcam" onclick="toggleWebcam()">Turn Off Webcam</button>
                </div>
            </div>
            
            

        </div>
        <div class="transfer-container">
            <h2>Transfer and Payments</h2>
            <form>
                <!-- Make a transfer from -->
                <div class="form-group">
                    <label for="transfer-from" onmouseover="speakText('Over here, you can choose which bank accounts do you want to make transfer from.')">1. Make a transfer from</label>
                    <select id="transfer-from" onchange="giveVoiceFeedback('transfer-from')">
                        <option value="" disabled selected>Select an account</option>
                    </select>
                </div>

                <!-- Transferring money to -->
                <div class="form-group">
                    <label>2. Send Money Using:</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="transfer-to" value="mobile" onclick="toggleInput('mobile');">
                            Mobile number
                        </label>
                        <label>
                            <input type="radio" name="transfer-to" value="nric" onclick="toggleInput('nric');">
                            NRIC
                        </label>
                    </div>
                    
                    <!-- Transfer input group with text box below the options -->
                    <div class="transfer-input-group" style="display: none;">
                        <input type="text" id="mobile" class="input-box" placeholder="Enter mobile number" style="display: none;" oninput="giveVoiceFeedback('mobile')">
                        <input type="text" id="nric" class="input-box" placeholder="Enter NRIC" style="display: none;" oninput="giveVoiceFeedback('nric')">
                        <button type="button" id="enterBtn" class="enter-btn">Verify</button>
                    </div>

                    <!-- Display recipient name below the input group -->
                    <p id="verifiedName" style="display: none;">Recipient Name: <span id="user-namee" style="font-weight: bold;"></span></p>
                    <p id="error" style="display: none;">Recipient Name: <span id="user-namee" style="font-weight: bold;"></span></p>
                </div>

                <!-- Amount and Description -->
                <div class="form-group">
                    <label for="amount" onmouseover="speakText('Enter the amount that you want to transfer, in Singapore dollars.')">3. Amount to Transfer:</label>
                    <div class="amount-transfer">
                        <input type="text" id="amount" placeholder="Amount(SGD)" oninput="giveVoiceFeedback('amount')">
                    </div>
                    <div id="balance" class="balance-display" style="display: none;">
                        Current Balance: <b><span id="balance-amount"></span> SGD</b>
                    </div>
                </div>

                <div class="form-group">
                    <label for="description" onmouseover="speakText('Enter a description for this transfer, like the purpose and your name')">4. Description of Transfer:</label>
                    <p style="padding-bottom:5px;">Include the purpose of transfer and your name </p>
                    <!-- Description input field to be filled with dynamic value -->
                    <input type="text" id="description" placeholder="Description" oninput="giveVoiceFeedback('description')">
                    <!-- Checkbox for saving as a favorite transaction -->
                    <label>
                        <input type="checkbox" id="status-checkbox" onchange="giveVoiceFeedback('status-checkbox')"> Enable 24-Hour Delay Transfer (Optional)
                        <span class="info-icon">What is this?
                            <span class="tooltip-text">This option delays the transfer by 24 hours. During this period, you can cancel the transaction 
                                if needed. After 24 hours, the funds will be sent and deducted from your account automatically.</span>
                        </span>
                    </label> 
                </div>

                <!-- Transfer button -->
                <div class="form-group">
                    <button type="submit" class="transfer-btn" onmouseover="speakText('Click here to complete the transfer. Please double-check that all details are correct before proceeding.')">Transfer</button>
                </div>
            </form>
            <div id="update-msg" style="display: none;">
                <div class="alert alert-success" role="alert">
                    <dotlottie-player src="https://lottie.host/3a0e448a-e059-491a-ba78-53734f104751/5XWEjdqtkJ.json" background="transparent" speed="0.7" style="width: 300px; height: 300px;" loop autoplay></dotlottie-player>
                </div>
            </div>
            
        </div>
    </main>

    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
    <script src="../js/transferform.js"></script>
    <script>
        const videoElement = document.getElementById("webcam-video");
        const toggleWebcamButton = document.getElementById('toggle-webcam');
        let isWebcamActive = false;

        let camera; // Declare the camera variable globally

        function toggleWebcam() {
            const video = document.getElementById("webcam-video");
            const button = document.getElementById("toggle-webcam");

            if (!video || !button) {
                console.error("Webcam video or button element not found!");
                return;
            }

            if (video.style.display === "none") {
                // Show video and start webcam
                video.style.display = "block";
                button.textContent = "Turn Off Webcam";
                startWebcam(video);
            } else {
                // Hide video and stop webcam
                video.style.display = "none";
                button.textContent = "Turn On Webcam";
                stopWebcam(video);
            }
        }

        function startWebcam(video) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then((stream) => {
                    video.srcObject = stream;
                })
                .catch((err) => {
                    console.error("Error accessing webcam: ", err);
                });
        }

        function stopWebcam(video) {
            if (video.srcObject) {
                const stream = video.srcObject;
                stream.getTracks().forEach((track) => track.stop());
                video.srcObject = null;
            } else {
                console.warn("No active webcam stream to stop.");
            }
        }



        // Ensure the webcam is off when the page loads
        window.onload = () => {
            videoElement.style.display = 'none';
            toggleWebcamButton.textContent = 'Turn On Webcam';
            isWebcamActive = false;
        };

        // Gesture detection and MediaPipe Hands logic
        const formFields = [
            document.querySelector('#transfer-from'),
            document.querySelector('#mobile'),
            document.querySelector('#nric'),
            document.querySelector('#amount'),
            document.querySelector('#description'),
            document.querySelector('.transfer-btn'),
        ];

        const hands = new Hands({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`,
        });
        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.7,
            minTrackingConfidence: 0.7,
        });

        hands.onResults(onResults);

        let activeFieldIndex = 0;

        function onResults(results) {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];

                if (isOpenHand(landmarks)) {
                    console.log('Open Hand Detected: Clearing the current field');
                    clearField();
                } else if (isThumbsUp(landmarks)) {
                    console.log('Thumbs Up Detected: Submitting the form');
                    formFields[formFields.length - 1].click();
                } else if (isPeaceSign(landmarks)) {
                    console.log('Peace Sign Detected: Moving to the next field');
                    moveToNextField();
                } else {
                    console.log('Unknown Gesture Detected');
                }
            } else {
                console.log('No hand detected');
            }
        }

        function clearField() {
            if (activeFieldIndex < formFields.length - 1) {
                const activeField = formFields[activeFieldIndex];
                if (activeField.tagName === 'INPUT' || activeField.tagName === 'TEXTAREA' || activeField.tagName === 'SELECT') {
                    activeField.value = '';
                }
            }
        }

        function moveToNextField() {
            if (activeFieldIndex < formFields.length - 1) {
                const currentField = formFields[activeFieldIndex];
                const nextField = formFields[++activeFieldIndex];

                if (currentField) currentField.blur();
                if (nextField) nextField.focus();
            }
        }

        function isOpenHand(landmarks) {
            return (
                landmarks[8].y < landmarks[7].y && // Index finger extended
                landmarks[12].y < landmarks[11].y && // Middle finger extended
                landmarks[16].y < landmarks[15].y && // Ring finger extended
                landmarks[20].y < landmarks[19].y && // Pinky finger extended
                landmarks[4].x > landmarks[3].x // Thumb pointing outward
            );
        }

        function isThumbsUp(landmarks) {
            return (
                landmarks[4].y < landmarks[3].y + 0.05 &&
                landmarks[8].y > landmarks[7].y &&
                landmarks[12].y > landmarks[11].y &&
                landmarks[16].y > landmarks[15].y &&
                landmarks[20].y > landmarks[19].y
            );
        }

        function isPeaceSign(landmarks) {
            return (
                landmarks[8].y < landmarks[7].y && // Index finger extended
                landmarks[12].y < landmarks[11].y && // Middle finger extended
                landmarks[16].y > landmarks[15].y && // Ring finger curled
                landmarks[20].y > landmarks[19].y // Pinky curled
            );
        }

        // Ensure videoElement is defined

        setInterval(async () => {
            if (videoElement && videoElement.srcObject) {
                try {
                    // Process one frame every interval
                    await hands.send({ image: videoElement });
                    console.log("Running hand detection...");
                } catch (error) {
                    console.error("Error during hand detection:", error);
                }
            } else {
                console.warn("No active webcam stream detected for hand detection.");
            }
        }, 4000); // 4000ms = 4 seconds









        /*function typeInInputField(inputElement, text, speed) {
            let index = 0;

            // Clear the field before starting the animation, only if it's empty
            if (inputElement.value === "") {
                inputElement.value = "";
                inputElement.setAttribute("readonly", "true");

                const typingInterval = setInterval(() => {
                    if (index < text.length) {
                        inputElement.value += text[index];
                        index++;
                    } else {
                        clearInterval(typingInterval);
                        inputElement.removeAttribute("readonly");
                    }
                }, speed);

                // Clear the input when the user clicks on it
                inputElement.addEventListener("focus", () => {
                    clearInterval(typingInterval); // Stop the animation if typing is still happening
                    inputElement.value = ""; // Clear the field
                    inputElement.removeAttribute("readonly"); // Allow user input
                });
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const amountInput = document.getElementById("amount");
            const descriptionInput = document.getElementById("description");
            const nricInput = document.getElementById("nric");
            const phoneInput = document.getElementById("mobile");

            // Array of values to type in sequence
            const phoneValues = [
                "91234567 (Example of Singapore Phone Number with no prefixes)",
                "87654321 (Example of Singapore Phone Number with no prefixes)",
                "96672812 (Example of Singapore Phone Number with no prefixes)"
            ];

            const nricValues = [
                "T1234567F (Example of Singapore NRIC)",
                "S7654321J (Example of Singapore NRIC",
                "S1283948H (Example of Singapore NRIC)"
            ];

            const amountValues = [
                "100.00 (Example if you want to transfer SGD 100.00)",
                "200.50 (Example if you want to transfer SGD 200.50)",
                "50.23 (Example if you want to transfer SGD 50.23)"
            ];

            const descriptionValues = [
                "Tuition payment - JANE SMITH (Example)",
                "Payment for groceries - JOHN DOE (Example)",
                "Online course fee - ALEX LEE (Example)"
            ];

            let amountIndex = 0;
            let descriptionIndex = 0;
            let phoneIndex = 0;
            let nricIndex = 0;

            // Function to cycle through values every 5 seconds
            function startTypingCycle() {
                if (amountInput.value === "") {
                    typeInInputField(amountInput, amountValues[amountIndex], 100);
                }

                if (nricInput.value === "") {
                    typeInInputField(nricInput, nricValues[nricIndex], 100);
                }

                if (descriptionInput.value === "") {
                    typeInInputField(descriptionInput, descriptionValues[descriptionIndex], 100);
                }

                if (phoneInput.value === "") {
                    typeInInputField(phoneInput, phoneValues[phoneIndex], 100);
                }

                // Move to the next value, loop back to the start if needed
                amountIndex = (amountIndex + 1) % amountValues.length;
                descriptionIndex = (descriptionIndex + 1) % descriptionValues.length;
                nricIndex = (nricIndex + 1) % nricValues.length;
                phoneIndex = (phoneIndex + 1) % phoneValues.length;
            }

            // Start the first typing animation immediately
            startTypingCycle();

            // Repeat the typing animation every 10 seconds
            setInterval(startTypingCycle, 7000);
        });*/

      </script>
    <script src="https://website-widgets.pages.dev/dist/sienna.min.js" defer></script>
</body>
</html>
